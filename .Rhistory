library(MSGene)
ls()
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(
data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
library(data.table)
modelfit = fitfunc2(
data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
head(train)
train$Cad_0_censor_age
modelfit = fitfunc2(
data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
train$Cad_0_censor_age
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(df_frame = data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
df=data.table(train)
modelfit = fitfunc2(df_frame = data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
modelfit = fitfunc2(df_frame = df,
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
# source("~/multistate2//code/utils.R")
# source("~/multistate2//code/smoothtest.R")
# source("~/multistate2//code/newsmooth.R")
# source("~/multistate2/code/fitarray.R")
library("reshape2")
# source("~/multistate2/code/arrayindicate.R")
#
modelfit = fitfunc2(df_frame = df,
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
train$Cad_0_censor_age
modelfit = fitfunc2(df_frame = df,
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
source("~/multistate2//code/utils.R")
source("~/multistate2//code/smoothtest.R")
source("~/multistate2//code/newsmooth.R")
source("~/multistate2/code/fitarray.R")
library("reshape2")
source("~/multistate2/code/arrayindicate.R")
## training data: ask for access
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(
data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
ls()
rm(list=ls())
library(MSGene)
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(
data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
ls()
ls()
library(MSGene)
ls()
rm(list=ls())
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(
data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
library(data.table)
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(
data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
class(data.table(dfh))
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(
df_frame = data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
library("reshape2")
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(
df_frame = data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
source("~/multistate2//code/utils.R")
source("~/multistate2//code/smoothtest.R")
source("~/multistate2//code/newsmooth.R")
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(
df_frame = data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
source("~/multistate2/code/fitarray.R")
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(
df_frame = data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
library(MSGene)
ls()
rm(ls=ls())
rm(list=ls())
ls()
library(MSGene)
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(
data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
source("../multistate2/code/fitarray.R")
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(
data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
fitfunc
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(
df_frame=data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
environment()
library(MSGene)
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
train=dfh[1:(nrow(dfh)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(
df_frame=data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
library(MSGene)
library(MSGene)
library(MSGene)
devtools::install_github("surbut/MSGene")
require(MSGene)
data("testdf")
train=df2[1:(nrow(df2)*0.80),]
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
modelfit = fitfunc2(
df_frame=data.table::data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
attributes(modelfit)
a = coefplotsmooth2(
ages = ages,
start = nstates[1],
stop = "Cad",
modelfit = modelfit,
window_width = 20,
span = 0.75,
degree = 2
)
healthy_coefs = a$custom_smooth
```
devtools::install_github("surbut/MSGene")
devtools::install_github("surbut/MSGene")
devtools::install_github("surbut/MSGene")
detach("package:MSGene", unload = TRUE)
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE,warning = FALSE,message = FALSE,comment = FALSE,tidy = TRUE)
# Chunk 3
require(MSGene)
# Chunk 4
data("testdf")
# Chunk 5
train=df2[1:(nrow(df2)*0.80),]
# Chunk 6
ages=c(40:80)
nstates=c("Health", "Ht","HyperLip","Dm","Cad","death","Ht&HyperLip","HyperLip&Dm","Ht&Dm","Ht&HyperLip&Dm")
# Chunk 7
modelfit = fitfunc2(
df_frame=data.table::data.table(train),
ages = ages,
nstates = nstates,
mode = "binomial",
covariates = "cad.prs+f.31.0.0+smoke+antihtn_now+statin_now")
head(df2)
cov(df2)
df2$statin[is.na(df2$statin)]=0
df2$statin[is.na(df2$statin_age)]=0
head(df2)
continuous_vars <- ukb_data[, c("cad.prs")]
continuous_vars <- df2[, c("cad.prs")]
cov_matrix <- cov(continuous_vars)
continuous_vars <- df2[, "cad.prs"]
cov_matrix <- cov(continuous_vars)
df2=as.matrix(df2)
continuous_vars <- df2[, "cad.prs"]
cov_matrix <- cov(continuous_vars)
names(df2)
dfh
train
names(train)
dfukb=tran
dfukb=train
sim_cad.prs <- rnorm(n_samples, mean=mean(ukb_data$cad.prs), sd=sd(ukb_data$cad.prs))
sim_cad.prs <- rnorm(n_samples, mean=mean(ukb_data$cad.prs), sd=sd(ukb_data$cad.prs))
dim(train)
n_samples=dim(train)
n_samples=dim(train)[1]
sim_cad.prs <- rnorm(n_samples, mean=mean(ukb_data$cad.prs), sd=sd(ukb_data$cad.prs))
ukb_data=train
sim_cad.prs <- rnorm(n_samples, mean=mean(ukb_data$cad.prs), sd=sd(ukb_data$cad.prs))
fit <- glm(f.31.0.0 ~ cad.prs, data=ukb_data, family=binomial())
fit <- glm(f.31.0.0 ~ cad.prs, data=train, family=binomial())
fit <- glm(f.31.0.0 ~ cad.prs, data=train, family="binomial")
str(train)
fit <- glm(as.numeric(f.31.0.0) ~ cad.prs, data=train, family="binomial")
predicted_probs <- predict(fit, newdata=data.frame(cad.prs=sim_cad.prs), type="response")
sim_f.31.0.0 <- rbinom(n_samples, 1, predicted_probs)
fit_age <- lm(Cad_0_censor_age ~ cad.prs, data=ukb_data)
predicted_age <- predict(fit_age, newdata=data.frame(cad.prs=sim_cad.prs))
residuals <- residuals(fit_age)
sim_Cad_0_censor_age <- predicted_age + sample(residuals, n_samples, replace=TRUE)
simulated_df <- data.frame(sim_cad.prs, sim_f.31.0.0, sim_Cad_0_censor_age, ...)
readRDS("~/Library/CloudStorage/Dropbox-Personal/testdf.rds")
df2=readRDS("~/Library/CloudStorage/Dropbox-Personal/testdf.rds")
head(df2)
head(df2)
load("~/Library/CloudStorage/Dropbox-Personal///pheno_dir/output/merged_pheno_censor_final_withdrugs_smoke.rds")
df2$smoke=dfh$smoke
saveRDS(df2,"~/Library/CloudStorage/Dropbox-Personal/dfmsgene.rds")
head(Df2)
head(df2)
df2=df2[-c(df2$statin_age.1)]
df2=df2[,-c(df2$statin_age.1))
df2=df2[,-c(df2$statin_age.1)]
df2=df2[,-df2$statin_age.1)]
df2=c(df2[,c(1:14)],df2[,16])
head(df2)
df2=readRDS("~/Library/CloudStorage/Dropbox-Personal/dfmsgene.rds")
df2=df2[,-15]
head(df2)
df2$statin=dfh$statin
saveRDS(df2,file="~/Library/CloudStorage/Dropbox-Personal/dfmsgene.rds")
df2=readRDS("~/Library/CloudStorage/Dropbox-Personal/dfmsgene.rds")
head(df2)
readRDS("~/multistate2/output/proportionaloccupancy.rds")
class(df2)
head(data.table(df2))
df2=readRDS("~/Library/CloudStorage/Dropbox-Personal/testdf.rds")
head(testdf)
head(df2)
head(df2)
